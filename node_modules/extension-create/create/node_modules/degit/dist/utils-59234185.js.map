{"version":3,"file":"utils-59234185.js","sources":["../src/utils.js"],"sourcesContent":["import fs from 'fs';\nimport path from 'path';\nimport homeOrTmp from 'home-or-tmp';\nimport https from 'https';\nimport child_process from 'child_process';\nimport URL from 'url';\nimport Agent from 'https-proxy-agent';\nimport { rimrafSync, copydirSync } from 'sander';\n\nconst tmpDirName = 'tmp';\nconst degitConfigName = 'degit.json';\n\nexport { degitConfigName };\n\nexport class DegitError extends Error {\n\tconstructor(message, opts) {\n\t\tsuper(message);\n\t\tObject.assign(this, opts);\n\t}\n}\n\nexport function tryRequire(file, opts) {\n\ttry {\n\t\tif (opts && opts.clearCache === true) {\n\t\t\tdelete require.cache[require.resolve(file)];\n\t\t}\n\t\treturn require(file);\n\t} catch (err) {\n\t\treturn null;\n\t}\n}\n\nexport function exec(command) {\n\treturn new Promise((fulfil, reject) => {\n\t\tchild_process.exec(command, (err, stdout, stderr) => {\n\t\t\tif (err) {\n\t\t\t\treject(err);\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tfulfil({ stdout, stderr });\n\t\t});\n\t});\n}\n\nexport function mkdirp(dir) {\n\tconst parent = path.dirname(dir);\n\tif (parent === dir) return;\n\n\tmkdirp(parent);\n\n\ttry {\n\t\tfs.mkdirSync(dir);\n\t} catch (err) {\n\t\tif (err.code !== 'EEXIST') throw err;\n\t}\n}\n\nexport function fetch(url, dest, proxy) {\n\treturn new Promise((fulfil, reject) => {\n\t\tlet options = url;\n\n\t\tif (proxy) {\n\t\t\tconst parsedUrl = URL.parse(url);\n\t\t\toptions = {\n\t\t\t\thostname: parsedUrl.host,\n\t\t\t\tpath: parsedUrl.path,\n\t\t\t\tagent: new Agent(proxy)\n\t\t\t};\n\t\t}\n\n\t\thttps\n\t\t\t.get(options, response => {\n\t\t\t\tconst code = response.statusCode;\n\t\t\t\tif (code >= 400) {\n\t\t\t\t\treject({ code, message: response.statusMessage });\n\t\t\t\t} else if (code >= 300) {\n\t\t\t\t\tfetch(response.headers.location, dest, proxy).then(fulfil, reject);\n\t\t\t\t} else {\n\t\t\t\t\tresponse\n\t\t\t\t\t\t.pipe(fs.createWriteStream(dest))\n\t\t\t\t\t\t.on('finish', () => fulfil())\n\t\t\t\t\t\t.on('error', reject);\n\t\t\t\t}\n\t\t\t})\n\t\t\t.on('error', reject);\n\t});\n}\n\nexport function stashFiles(dir, dest) {\n\tconst tmpDir = path.join(dir, tmpDirName);\n\trimrafSync(tmpDir);\n\tmkdirp(tmpDir);\n\tfs.readdirSync(dest).forEach(file => {\n\t\tconst filePath = path.join(dest, file);\n\t\tconst targetPath = path.join(tmpDir, file);\n\t\tconst isDir = fs.lstatSync(filePath).isDirectory();\n\t\tif (isDir) {\n\t\t\tcopydirSync(filePath).to(targetPath);\n\t\t\trimrafSync(filePath);\n\t\t} else {\n\t\t\tfs.copyFileSync(filePath, targetPath);\n\t\t\tfs.unlinkSync(filePath);\n\t\t}\n\t});\n}\n\nexport function unstashFiles(dir, dest) {\n\tconst tmpDir = path.join(dir, tmpDirName);\n\tfs.readdirSync(tmpDir).forEach(filename => {\n\t\tconst tmpFile = path.join(tmpDir, filename);\n\t\tconst targetPath = path.join(dest, filename);\n\t\tconst isDir = fs.lstatSync(tmpFile).isDirectory();\n\t\tif (isDir) {\n\t\t\tcopydirSync(tmpFile).to(targetPath);\n\t\t\trimrafSync(tmpFile);\n\t\t} else {\n\t\t\tif (filename !== 'degit.json') {\n\t\t\t\tfs.copyFileSync(tmpFile, targetPath);\n\t\t\t}\n\t\t\tfs.unlinkSync(tmpFile);\n\t\t}\n\t});\n\trimrafSync(tmpDir);\n}\n\nexport const base = path.join(homeOrTmp, '.degit');\n"],"names":["rimrafSync","copydirSync"],"mappings":"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"}